<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta property="og:site_name" content="Duck's Nest List">
    <meta property="og:type" content="list">
    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="{{ location }} nests as of {{ rotation.date_priority_display }}">
	{% block self_url %}
    	<meta property="og:url" content="{{ url('nestlist:city_historic_date', city_id=location.ct().pk, date=rotation.pk) }}">
	{% endblock %}
    <link rel="stylesheet" type="text/css" href="{{ static('nestlist/css/style.css') }}">
    <!-- TODO: update icon later -->
    <link rel="icon" type="image/png" href="{{ static('nestlist/images/ballhead cc.png') }}">

    <style>
	{% if not history %}
	td.rotation, th.rotation {
		display: none;
	}{% endif %}
	{% if neighbor_view %}
	td.neighborhood, th.neighborhood {
		display: none;
	}{% endif %}
	{% if species_count == 1 %}
	td.species, th.species, td.number, th.number {
		display: none;
	}{% endif %}
	{% if nest_view %}
	td.nest-name, th.nest-name, td.neighborhood, th.neighborhood {
	  display: none;
	}{% endif %}
    </style>

    <script type="text/javascript" src="{{ static('nestlist/js/sort_t.js') }}"></script>
    <title>
		{{ location.get_name() }}
		Nests!
	</title>
</head>
<body ontouchstart="" onclick="">
<header>
	<p class="report-link"><a href="{{ location.ct().report_form_url() }}">Report a nest</a></p>
	{% block top_nav %}
	{% endblock %}
</header>
<main>
<table id="nestList">
	<caption>{% block information %} {{ location }}<br>#{{ rotation }} {% endblock %}</caption>
	<tr>
		<th onclick="sortTable('nestList', 0)" tabindex="0" class="heading rotation">Rotation</th>
		<th onclick="sortTable('nestList', 1)" tabindex="1" class="heading neighborhood">Neighborhood</th>
		<th onclick="sortTable('nestList', 2)" tabindex="2" class="heading nest-name">Park</th>
		<th onclick="sortTable('nestList', 3)" tabindex="3" class="heading number">#</th>
		<th onclick="sortTable('nestList', 4)" tabindex="4" class="heading species">Species</th>
		<th onclick="sortTable('nestList', 5)" tabindex="5" class="heading verification">2x?</th>
	</tr>
	{% for nest in current_nest_list %}
		<tr id="{{ nest.id }}" itemscope itemtype="https://schema.org/Place"
		class="nest {% if nest.confirmation %}confirmed{% else %}unconfirmed{% endif %}" >
			<td class="rotation">
				<span class="sort-info">{{ nest.rotation_num }}</span>
				<a href="{{ url('nestlist:city_historic_date', city_id=location.ct().pk, date=nest.rotation_num.pk) }}">{{ nest.rotation_num }}</a>
			</td>
			<td class="neighborhood" itemprop="containedInPlace"
			id="{{ nest.nestid.neighborhood.pk }}">
				<span class="sort-info">{{ nest.nestid.neighborhood }}</span>
				<a href="{{ nest.nestid.neighborhood.web_url() }}">{{ nest.nestid.neighborhood }}</a>
			</td>
			<td class="nest-name tooltip" itemprop="name">
				<span class="sort-info">{{ nest.nestid.full_name() }}</span>
				<a href="{{ nest.nestid.web_url() }}">{{ nest.nestid.get_name() }}</a>
				<div class="tooltiptext">
					{% if nest.nestid.address %}
					<address itemprop="address">{{ nest.nestid.address }}</address>
					{% else %}
					<span class="address-error">No address on file</span>
					{% endif %}
					{% if nest.nestid.private %}
					<div class="privacy-notice">Private property, please be respectful</div>
					{% endif %}
				</div>
			</td>
			<td class="number">
				{% if nest.sp_no() %}
				<span class="sort-info">{{ nest.sp_no() }}</span> {# zero-pad to make sorting happy #}
				<a href="{{ url('nestlist:species_history', city_id=location.ct().pk, poke=nest.species_no) }}">
					{{ nest.sp_no() }}
				</a>
				{% else %}N/A{% endif %}
			</td>
			<td class="species">
				{% if nest.species_name_fk %}
				<span class="sort-info">{{ nest.species_name_fk }}</span>
				<a href="{{ url('nestlist:species_history', city_id=location.ct().pk, poke=nest.species_name_fk.pk) }}">{{ nest.species_txt }}</a>
				{% else %}{{ nest.species_txt }}{% endif %}
			</td>
			<td class="verification tooltip">
				<span class="sort-info">{% if nest.confirmation %}1{% else %}2{% endif %}</span>
				{% if nest.confirmation %}âœ…{% else %}ðŸ”­{% endif %}
				{% if nest.report_audit.all() %}
				<div class="tooltiptext audit">
					{% for rpt in nest.report_audit.all()|sort(attribute="timestamp", reverse=True) %}
					<span class="{% if not rpt.bot.restricted() %}ge{% endif %}">
						<span class="m">{{ rpt.web_str()[1] }}</span> {# species info #}
						<span style="display:inline-block;"> {# timestamp #}
							{{ rpt.web_str()[0].strftime("%b") }}
							{{ rpt.web_str()[0].strftime("%d")|ordinal }}
							{{ rpt.web_str()[0].strftime("%H:%M") }}
							<span class="f">{{ rpt.web_str()[2] }}</span> {# hashed username #}
						</span></span><br>
					{% endfor %}
				</div>
				{% endif %}
			</td>
		</tr>
	{% endfor %}
</table>
</main>
<hr>
<footer>
	{% block bottom_notes %}
	<p class="confirmed">
		âœ… Species with a <span class="species">bold name</span> and an <span class="number">italic pokÃ©dex number</span> have multiple confirming reports.
		<br>
		{{ current_nest_list.filter(confirmation=True).count() }} out of {{ current_nest_list.count() }} reports confirmed.
		<br>
		ðŸ”­ Nests only have a single report.
	</p>
	<p>Mid-rotation events may throw off the accuracy of the list.</p>
	<p class="report-link"><a href="{{ location.ct().report_form_url() }}">Report a nest</a></p>
	<a style="font-size: small;" href="https://github.com/duck57/poke-db/tree/master/pokedb/nestlist">source</a>
	{% endblock %}
</footer>
{% block empty_zone %}{% endblock %}
</body></html>